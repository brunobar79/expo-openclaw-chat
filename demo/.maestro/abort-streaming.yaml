appId: com.anonymous.demo
tags:
  - chat
  - streaming
env:
  GATEWAY_URL: ${GATEWAY_URL}
  GATEWAY_TOKEN: ${GATEWAY_TOKEN}
---

# ── Configure & Open Chat ─────────────────────────────────────
- launchApp:
    label: Launch demo app

- extendedWaitUntil:
    visible:
      id: "gateway-url-input"
    timeout: 45000
    label: Wait for configuration screen (includes JS bundle load)

- tapOn:
    id: "gateway-url-input"
    label: Focus gateway URL input
- inputText:
    text: ${GATEWAY_URL}
    label: Enter gateway URL
- tapOn:
    id: "auth-token-input"
    label: Focus auth token input
- inputText:
    text: ${GATEWAY_TOKEN}
    label: Enter auth token
- tapOn:
    id: "configure-btn"
    label: Tap Configure

- extendedWaitUntil:
    visible:
      id: "open-chat-btn"
    timeout: 5000
    label: Wait for configured state
- tapOn:
    id: "open-chat-btn"
    label: Open chat modal

# ── Wait for Connection ───────────────────────────────────────
- extendedWaitUntil:
    visible:
      id: "chat-input"
    timeout: 15000
    label: Wait for chat to connect

# ── Send Long Message & Abort ─────────────────────────────────
- tapOn:
    id: "chat-input"
    label: Focus chat input
- inputText:
    text: "Write a very long 1000 word essay about the ocean. Do not stop early."
    label: Type message requesting long response
- tapOn:
    id: "chat-send-btn"
    label: Send the message

# ── Wait for Streaming to Start ───────────────────────────────
- extendedWaitUntil:
    visible:
      id: "chat-abort-btn"
    timeout: 15000
    label: Wait for abort button to appear (streaming started)

# ── Abort the Stream ──────────────────────────────────────────
- tapOn:
    id: "chat-abort-btn"
    label: Tap abort button to stop streaming

# ── Verify Input is Ready Again ───────────────────────────────
- extendedWaitUntil:
    visible:
      id: "chat-send-btn"
    timeout: 10000
    label: Wait for send button to reappear (streaming stopped)

- assertVisible:
    id: "chat-input"
    label: Verify chat input is available after abort
