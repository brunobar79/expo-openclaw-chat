appId: com.anonymous.demo
tags:
  - chat
  - e2e
env:
  GATEWAY_URL: ${GATEWAY_URL}
  GATEWAY_TOKEN: ${GATEWAY_TOKEN}
---

# ── Configure Gateway ─────────────────────────────────────────
- launchApp:
    label: Launch demo app

- extendedWaitUntil:
    visible:
      id: "gateway-url-input"
    timeout: 45000
    label: Wait for configuration screen (includes JS bundle load)

- tapOn:
    id: "gateway-url-input"
    label: Focus gateway URL input
- inputText:
    text: ${GATEWAY_URL}
    label: Enter gateway URL

- tapOn:
    id: "auth-token-input"
    label: Focus auth token input
- inputText:
    text: ${GATEWAY_TOKEN}
    label: Enter auth token

- tapOn:
    id: "configure-btn"
    label: Tap Configure button

# ── Open Chat Modal ───────────────────────────────────────────
- extendedWaitUntil:
    visible:
      id: "open-chat-btn"
    timeout: 5000
    label: Wait for configured state

- tapOn:
    id: "open-chat-btn"
    label: Open chat modal

# ── Wait for Connection ───────────────────────────────────────
- extendedWaitUntil:
    visible:
      id: "chat-input"
    timeout: 15000
    label: Wait for chat to connect and show input

# ── Send a Message ────────────────────────────────────────────
- tapOn:
    id: "chat-input"
    label: Focus chat input
- inputText:
    text: "Hello! What is 2 + 2?"
    label: Type a test message
- tapOn:
    id: "chat-send-btn"
    label: Send the message

# ── Wait for Reply ────────────────────────────────────────────
- extendedWaitUntil:
    visible: ".*4.*"
    timeout: 30000
    label: Wait for assistant reply containing the answer

# ── Verify Input Ready for Next Message ───────────────────────
- assertVisible:
    id: "chat-input"
    label: Verify input is ready for another message

# ── Close Chat ────────────────────────────────────────────────
- tapOn:
    id: "chat-close-btn"
    label: Close the chat modal

- extendedWaitUntil:
    visible:
      id: "open-chat-btn"
    timeout: 5000
    label: Verify returned to main screen
